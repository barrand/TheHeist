<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Heist - Marcus "The Vault" Romano Interaction</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0D0517;  /* Neon Purple bg-primary */
            color: #FFFFFF;
            padding: 20px;
            line-height: 1.5;
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: bold;
            color: #B565FF;  /* accent-primary */
            margin-bottom: 8px;
        }
        
        .header p {
            font-size: 14px;
            color: #B0B0B0;  /* text-secondary */
        }
        
        .card {
            background: #1A0F2E;  /* bg-secondary */
            border: 1px solid #3A2550;  /* border-subtle */
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .card.selected {
            border: 2px solid #B565FF;
            box-shadow: 0 4px 12px rgba(181, 101, 255, 0.3);
        }
        
        .character-section {
            text-align: center;
            margin-bottom: 24px;
        }
        
        .character-image {
            width: 280px;
            height: 280px;
            border-radius: 12px;
            border: 3px solid #B565FF;
            margin: 0 auto 16px;
            display: block;
        }
        
        .character-name {
            font-size: 20px;
            font-weight: bold;
            color: #FFFFFF;
            margin-bottom: 4px;
        }
        
        .character-role {
            font-size: 14px;
            color: #B0B0B0;
        }
        
        .objective-section {
            background: #2A1A45;  /* bg-tertiary */
            border: 2px solid #B565FF;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .objective-header {
            font-size: 12px;
            font-weight: 600;
            color: #D199FF;  /* accent-light */
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .objective-text {
            font-size: 14px;
            color: #FFFFFF;
            line-height: 1.6;
        }
        
        .chat-container {
            background: #1A0F2E;
            border: 1px solid #3A2550;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            min-height: 300px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .chat-message {
            margin-bottom: 12px;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .chat-bubble {
            padding: 12px 16px;
            border-radius: 12px;
            max-width: 80%;
            word-wrap: break-word;
        }
        
        .chat-bubble.npc {
            background: #2A1A45;
            border: 1px solid #3A2550;
            border-radius: 12px 12px 12px 4px;
        }
        
        .chat-bubble.player {
            background: #B565FF;
            color: #0D0517;
            border-radius: 12px 12px 4px 12px;
            margin-left: auto;
        }
        
        .chat-label {
            font-size: 11px;
            font-weight: 600;
            color: #888888;
            margin-bottom: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .chat-text {
            font-size: 14px;
            line-height: 1.5;
        }
        
        .input-section {
            margin-bottom: 16px;
        }
        
        .input-field {
            width: 100%;
            background: #2A1A45;
            border: 1px solid #3A2550;
            border-radius: 8px;
            padding: 12px;
            color: #FFFFFF;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
        }
        
        .input-field:focus {
            outline: none;
            border: 2px solid #B565FF;
            box-shadow: 0 0 0 3px rgba(181, 101, 255, 0.1);
        }
        
        .button {
            width: 100%;
            background: #B565FF;
            color: #0D0517;
            border: none;
            border-radius: 8px;
            padding: 14px 24px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.15s;
            box-shadow: 0 2px 8px rgba(181, 101, 255, 0.3);
        }
        
        .button:hover {
            background: #D199FF;
            transform: translateY(-1px);
        }
        
        .button:active {
            background: #8B3FCC;
            transform: scale(0.98);
        }
        
        .button:disabled {
            background: #555555;
            color: #888888;
            cursor: not-allowed;
            transform: none;
        }
        
        .button.secondary {
            background: transparent;
            color: #FFFFFF;
            border: 2px solid #4A3560;
        }
        
        .button.secondary:hover {
            border-color: #B565FF;
            color: #B565FF;
        }
        
        .status {
            text-align: center;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-weight: 600;
        }
        
        .status.success {
            background: #1E2A3A;
            border: 2px solid #00E5FF;
            color: #00E5FF;
        }
        
        .status.failure {
            background: #3A1E1E;
            border: 2px solid #E53935;
            color: #E53935;
        }
        
        .difficulty-badge {
            display: inline-block;
            background: #FF6B9D;
            color: #0D0517;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .loading {
            text-align: center;
            color: #B0B0B0;
            font-size: 14px;
            padding: 12px;
        }
        
        .info-text {
            font-size: 12px;
            color: #888888;
            text-align: center;
            margin-top: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ­ THE HEIST</h1>
            <p>NPC Interaction Prototype</p>
        </div>
        
        <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                <span style="font-size: 14px; color: #B0B0B0;">Difficulty</span>
                <span class="difficulty-badge">MEDIUM</span>
            </div>
            <div style="font-size: 12px; color: #888888; line-height: 1.5;">
                Being too direct or suspicious will make them clam up
            </div>
        </div>
        
        <div class="character-section">
            <img src="marcus_"the_vault"_romano.png" alt="Marcus "The Vault" Romano" class="character-image">
            <div class="character-name">Marcus "The Vault" Romano</div>
            <div class="character-role">Bank Security Chief</div>
        </div>
        
        <div class="card">
            <div style="font-size: 12px; font-weight: 600; color: #888888; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                Scenario
            </div>
            <div style="font-size: 14px; color: #FFFFFF; line-height: 1.6;">
                You've been hired as a new night janitor at the high-security bank. Marcus is doing your orientation and seems friendly, but he's very protective of security protocols.
            </div>
        </div>
        
        <div class="objective-section">
            <div class="objective-header">ðŸŽ¯ Your Objective</div>
            <div class="objective-text">Learn the night shift rotation schedule</div>
        </div>
        
        <div class="chat-container" id="chatContainer"></div>
        
        <div id="statusContainer"></div>
        
        <div class="input-section">
            <textarea 
                id="playerInput" 
                class="input-field" 
                placeholder="Type your response..."
                rows="2"
            ></textarea>
        </div>
        
        <button id="sendButton" class="button" onclick="sendMessage()">
            Send Message
        </button>
        
        <button class="button secondary" onclick="resetConversation()" style="margin-top: 12px;">
            Reset Conversation
        </button>
        
        <div class="info-text">
            Powered by Gemini 2.5 Flash â€¢ Neon Purple Theme
        </div>
    </div>
    
    <script>
        const NPC_NAME = "Marcus "The Vault" Romano";
        const NPC_ROLE = "Bank Security Chief";
        const OBJECTIVE_INFO = "Guards rotate every 4 hours: 8pm, 12am, 4am";
        const DIFFICULTY = "medium";
        
        // Pre-filled API key (prototype only - never commit with real key)
        const API_KEY = "AIzaSyD6Hg69OL3ihApHiwRdAllEW2f2FZ4Rrds";
        
        let conversationHistory = [];
        let gameOver = false;
        
        // NPC personality based on difficulty
        const npcPrompts = {
            easy: `You are Marcus "The Vault" Romano, a Bank Security Chief. You are professional but cautious.
            
The player is trying to learn: Learn the night shift rotation schedule
The answer is: Guards rotate every 4 hours: 8pm, 12am, 4am

You will naturally reveal this information through friendly conversation. Be helpful and share details willingly. You enjoy chatting and helping people.`,
            
            medium: `You are Marcus "The Vault" Romano, a Bank Security Chief. You are professional but cautious.
            
The player is trying to learn: Learn the night shift rotation schedule
The answer is: Guards rotate every 4 hours: 8pm, 12am, 4am

You will reveal this information if the player builds rapport and asks the right questions. You're not immediately suspicious, but you don't volunteer sensitive information to strangers. If they're polite and clever, you'll share what you know. If they're too direct or pushy, you become guarded.`,
            
            hard: `You are Marcus "The Vault" Romano, a Bank Security Chief. You are professional but cautious.
            
The player is trying to learn: Learn the night shift rotation schedule
The answer is: Guards rotate every 4 hours: 8pm, 12am, 4am

You are VERY protective of this information. You will only reveal it if the player:
1. Builds significant trust over multiple exchanges
2. Has a convincing reason why they need to know
3. Never seems suspicious or threatening

If they ask too directly, seem suspicious, or make you uncomfortable, you will shut down the conversation. You might give subtle hints if they're very clever, but you never directly share sensitive information unless they've really earned your trust.`
        };
        
        const systemPrompt = npcPrompts[DIFFICULTY];
        
        // Add initial greeting
        addNPCMessage(getGreeting());
        
        function getGreeting() {
            const greetings = [
                "Hey there. Can I help you with something?",
                "Hello. What brings you here?",
                "Good to see you. What's up?",
            ];
            return greetings[Math.floor(Math.random() * greetings.length)];
        }
        
        async function sendMessage() {
            if (gameOver) return;
            
            const input = document.getElementById('playerInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add player message
            addPlayerMessage(message);
            input.value = '';
            
            // Disable input while processing
            toggleInput(false);
            showLoading();
            
            // Add to history
            conversationHistory.push({
                role: 'user',
                parts: [{ text: message }]
            });
            
            try {
                // Get NPC response
                const npcResponse = await getNPCResponse(message);
                hideLoading();
                addNPCMessage(npcResponse);
                
                conversationHistory.push({
                    role: 'model',
                    parts: [{ text: npcResponse }]
                });
                
                // Check if information was revealed
                await checkIfInfoRevealed();
                
            } catch (error) {
                hideLoading();
                console.error('Error:', error);
                addNPCMessage("Sorry, I didn't catch that. Could you repeat?");
            }
            
            toggleInput(true);
        }
        
        async function getNPCResponse(message) {
            const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-lite:generateContent?key=${API_KEY}`,
                {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        system_instruction: { parts: [{ text: systemPrompt }] },
                        contents: conversationHistory,
                        generationConfig: {
                            temperature: 0.9,
                            maxOutputTokens: 200,
                        }
                    })
                }
            );
            
            const data = await response.json();
            console.log('NPC Response:', data);
            
            if (data.candidates && data.candidates[0]) {
                return data.candidates[0].content.parts[0].text;
            }
            
            throw new Error('No response from API');
        }
        
        async function checkIfInfoRevealed() {
            // Use LLM to check if the critical information was revealed
            const checkPrompt = `Based on this conversation, has the NPC revealed the following information: "${OBJECTIVE_INFO}"?

Conversation:
${conversationHistory.map(msg => 
    `${msg.role === 'user' ? 'Player' : NPC_NAME}: ${msg.parts[0].text}`
).join('\n')}

Answer with ONLY "YES" or "NO". Answer YES if the information was clearly communicated, even if phrased differently.`;
            
            const response = await fetch(
                `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-lite:generateContent?key=${API_KEY}`,
                {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: checkPrompt }] }],
                        generationConfig: {
                            temperature: 0.1,
                            maxOutputTokens: 10,
                        }
                    })
                }
            );
            
            const data = await response.json();
            const answer = data.candidates[0].content.parts[0].text.trim().toUpperCase();
            
            console.log('Info revealed check:', answer);
            
            if (answer.includes('YES')) {
                showSuccess();
            }
        }
        
        function addPlayerMessage(text) {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            messageDiv.innerHTML = `
                <div style="display: flex; justify-content: flex-end;">
                    <div class="chat-bubble player">
                        <div class="chat-text">${escapeHtml(text)}</div>
                    </div>
                </div>
            `;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }
        
        function addNPCMessage(text) {
            const container = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';
            messageDiv.innerHTML = `
                <div class="chat-bubble npc">
                    <div class="chat-label">${NPC_NAME}</div>
                    <div class="chat-text">${escapeHtml(text)}</div>
                </div>
            `;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }
        
        function showLoading() {
            const container = document.getElementById('chatContainer');
            const loadingDiv = document.createElement('div');
            loadingDiv.id = 'loadingIndicator';
            loadingDiv.className = 'loading';
            loadingDiv.textContent = '...';
            container.appendChild(loadingDiv);
            container.scrollTop = container.scrollHeight;
        }
        
        function hideLoading() {
            const loading = document.getElementById('loadingIndicator');
            if (loading) loading.remove();
        }
        
        function showSuccess() {
            gameOver = true;
            const statusContainer = document.getElementById('statusContainer');
            statusContainer.innerHTML = `
                <div class="status success">
                    âœ… SUCCESS! You learned: Guards rotate every 4 hours: 8pm, 12am, 4am
                </div>
            `;
            toggleInput(false);
        }
        
        function toggleInput(enabled) {
            document.getElementById('playerInput').disabled = !enabled;
            document.getElementById('sendButton').disabled = !enabled;
        }
        
        function resetConversation() {
            conversationHistory = [];
            gameOver = false;
            document.getElementById('chatContainer').innerHTML = '';
            document.getElementById('statusContainer').innerHTML = '';
            document.getElementById('playerInput').value = '';
            toggleInput(true);
            addNPCMessage(getGreeting());
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Enter key to send
        document.getElementById('playerInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    </script>
</body>
</html>
